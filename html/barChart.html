<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>BarChart</title>
<link href="../styles/demo.css" rel="stylesheet">
<script type="text/javascript" src="../js/d3.js"></script>
<style type="text/css">
    .axis path,
    .axis line {
      fill: none;
      stroke: black;
      shape-rendering: crispEdges;
    }
    .axis text {
      font-size: 10px;
    }

    #toolTip {
        position: absolute;
        width: 200px;
        height: auto;
        padding: 10px;
        background-color: white;
        border-radius: 10px;
        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
        pointer-events: none;
    }

    #toolTip {
        display: none;
    }

    #toolTip p {
        margin: 0;
        font-size: 16px;
        line-height: 20px;
    }
</style>
</head>
<body>
    <div>
        <p>Click the button to change the data</p>
        <button class="change">Change Data</button>
        <button class="sort">Sort</button>
        <div id="toolTip">
            <p><strong>This value is</strong></p>
            <p><span id="value">100</span></p>
        </div>
    </div>
    <script type="text/javascript">
    	var dataset = [20, 30, 43, 12, 43, 23, 19, 45, 33, 22, 11, 44, 10, 40, 28, 37, 23, 8, 38, 16];

    	var width = 1000;
    	var height = 500;
      var xAxisWidth = 900;
      var yAxisWidth = 400;
      var padding = {
        top : 20,
        right : 20,
        bottom : 20,
        left : 20
      };

      var xScale = d3.scale.ordinal()
                           .domain(d3.range(dataset.length))
                           .rangeRoundBands([0, xAxisWidth], 0.05);

      var yScale = d3.scale.linear()
                           .domain([0, d3.max(dataset)])
                           .range([0, yAxisWidth]);

    	var svg = d3.select("body")
    		.append("svg")
    		.attr("width", width)
    		.attr("height", height);

    	var rect = svg.selectAll("rect")
    		.data(dataset)
    		.enter()
    		.append("rect")
    		.attr("x", function(d, i) {
    			return xScale(i) + padding.left;
    		})
    		.attr("y", function(d) {
    			return height - yScale(d) - padding.bottom;
    		})
    		.attr("width", xScale.rangeBand())
    		.attr("height", function(d) {
    			return yScale(d);
    		})
    		.attr("fill", function(d) {
    			return "rgb(0, 0, " + d * 10 + ")";
    		});

    	var texts = svg.selectAll("text")
    		.data(dataset)
    		.enter()
    		.append("text")
    		.text(function(d) {
    			return d;
    		})
    		.attr("x", function(d, i) {
    			return xScale(i) + xScale.rangeBand() / 2 + padding.left ;
    		})
    		.attr("y", function(d) {
    			return height - yScale(d) - padding.bottom;
    		})
        .attr("dx", -10)
        .attr("dy", 20)
    		.attr("font-size", "15px")
    		.attr("fill", "white");

        d3.select(".change")
          .on("click", function() {
            var dataCount = 20;
            var maxValue = 40;
            dataset.splice(0, dataCount);
            for (let i = 0; i < dataCount; i++) {
                var newData = Math.floor(Math.random() * maxValue);
                dataset.push(newData);
            }

            svg.selectAll("rect")
               .data(dataset)
               .transition()
               .delay(function(d, i) {
                    return i / dataset.length * 1000;
               })
               .duration(1000)
               .ease("cubic-in-out")
               .attr("y", function(d) {
                    return height - yScale(d) - padding.bottom;
               })
               .attr("height", function(d) {
                    return yScale(d);
               })
               .attr("fill", function(d) {
                    return "rgb(0, 0," + d * 10 + ")";
               });

            svg.selectAll("text")
               .data(dataset)
               .text(function(d) {
                    return d;
               })
               .transition()
               .delay(function(d, i) {
                    return i / dataset.length * 1000;
               })
               .duration(1000)
               .ease("cubic-in-out")
               .attr("x", function(d, i) {
                    return xScale(i) + xScale.rangeBand() / 2 + padding.left;
               })
               .attr("y", function(d) {
                    return height - yScale(d) - padding.bottom;
               })
               .attr("class", "data");
        });

        d3.selectAll("rect")
            .on("mouseover", function(d) {
                d3.select(this)
                  .transition()
                  .duration(250)
                  .attr("fill", "orange");

                var xPosition = parseFloat(d3.select(this).attr("x")) + xScale.rangeBand() / 2;
                var yPosition = parseFloat(d3.select(this).attr("y")) + (height - d3.select(this).attr("y")) / 2;
                d3.select("#toolTip")
                  .style("left", xPosition + "px")
                  .style("top", yPosition + "px")
                  .style("display", "block")
                  .select("#value")
                  .text(d);
            })
            .on("mouseout", function(d) {
                d3.select(this)
                  .transition()
                  .duration(250)
                  .attr("fill","rgb(0, 0," + d * 10 + ")");

                d3.select("#toolTip")
                  .style("display", "none");
            });

        d3.select(".sort")
          .on("click", function() {
                d3.selectAll("rect")
                  .sort(function(a, b) {
                        return d3.ascending(a, b);
                  })
                  .transition()
                  .duration(1000)
                  .attr("x", function(d, i) {
                        return xScale(i) + padding.left;
                  });
                
                d3.selectAll(".data")
                  .sort(function(a, b) {
                        return d3.ascending(a, b);
                  })
                  .text(function(d) {
                        return d;
                  })
                  .transition()
                  .duration(1000)
                  .attr("x", function(d, i) {
                        return xScale(i) + xScale.rangeBand() / 2 + padding.left;
                  })
                  .attr("y", function(d) {
                        return height - yScale(d) - padding.bottom;
                  });
            });
        
        var datasetCount = d3.range(dataset.length);
        for (let i = 0; i < dataset.length; i++)
          datasetCount[i] += 1;
        
        var xAxisScale = d3.scale.ordinal()
                           .domain(datasetCount)
                           .rangeRoundBands([0, xAxisWidth], 0.05);

        var yAxisScale = d3.scale.linear()
                           .domain([0, d3.max(dataset)])
                           .range([yAxisWidth, 0]);

        var xAxis = d3.svg.axis()
                          .scale(xAxisScale)
                          .orient("bottom")
                 
        svg.append("g")
           .attr("class", "axis")
           .attr("transform", "translate(" + padding.left + "," + (height - padding.top) + ")")
           .call(xAxis);

        var yAxis = d3.svg.axis()
                          .scale(yAxisScale)
                          .orient("left")
                          .ticks(5);

        svg.append("g")
           .attr("class", "axis")
           .attr("transform", "translate(" + padding.left + "," + (height - yAxisWidth - padding.bottom) + ")")
           .call(yAxis);
    </script>
</body>
</html>